<!DOCTYPE html>
<html lang="de" data-theme="day">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Riverty â€“ Beruhigender Screensaver (Auto Tag/Nacht)</title>
  <script>
    (function(){
      function Z(d,lat,lon,zen){var N=(function(x){var s=new Date(x.getFullYear(),0,0);return Math.floor((x-s+(s.getTimezoneOffset()-x.getTimezoneOffset())*6e4)/864e5)})(d),lh=lon/15,rad=Math.PI/180;
        function one(isRise){var t=N+((isRise?6:18)-lh)/24,M=0.9856*t-3.289,L=M+1.916*Math.sin(M*rad)+0.02*Math.sin(2*M*rad)+282.634;L=(L%360+360)%360;var RA=Math.atan(0.91764*Math.tan(L*rad))/rad;RA=((RA%360)+360)%360;RA+=Math.floor(L/90)*90-Math.floor(RA/90)*90;RA/=15;var sD=0.39782*Math.sin(L*rad),cD=Math.cos(Math.asin(sD));var cH=(Math.cos(zen*rad)-sD*Math.sin(lat*rad))/(cD*Math.cos(lat*rad));var H=(isRise?360-Math.acos(cH)/rad:Math.acos(cH)/rad)/15;var T=H+RA-0.06571*t-6.622;var UT=T-lh;return (UT+24)%24}
        var tz=-d.getTimezoneOffset()/60;return {sr: (one(true)+tz), ss:(one(false)+tz)} }
      var lat=48.2082, lon=16.3738, zen=90.833, now=new Date();
      var s=Z(now,lat,lon,zen), tw=45, m=now.getHours()*60+now.getMinutes(),
          sr=s.sr*60, ss=s.ss*60, blend=0;
      function S(a,b,x){var t=(x-a)/(b-a);return t<0?0:t>1?1:t*t*(3-2*t)}
      if(m<sr-tw||m>ss+tw){blend=1}
      else if(m>sr+tw&&m<ss-tw){blend=0}
      else if(m>=sr-tw&&m<=sr+tw){blend=1-S(sr-tw,sr+tw,m)}
      else if(m>=ss-tw&&m<=ss+tw){blend=S(ss-tw,ss+tw,m)}
      document.documentElement.setAttribute('data-theme', blend>=0.5?'night':'day');
    })();
  </script>
  <style>
    :root{
      --sky-top:#9fbfda;
      --sky-bottom:#d2e4f0;
      --water-1:#7fb0c6;
      --water-2:#5a94ab;
      --water-3:#366f85;
      --mote:#0f2a37;
      --text:#0f2a37;
      --logo: rgba(15,42,55,.06);
      --transition:.8s ease;
      --bg: linear-gradient(180deg,var(--sky-top),var(--sky-bottom));
    }
    [data-theme="night"]{
      --sky-top:#0b1d2b;
      --sky-bottom:#152a37;
      --water-1:#295268;
      --water-2:#1f4458;
      --water-3:#163646;
      --mote:#e7f0f5;
      --text:#e7f0f5;
      --logo: rgba(231,240,245,.10);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family:Inter,"Segoe UI",system-ui,-apple-system,sans-serif;color:var(--text);background:var(--bg);overflow:hidden;transition:background var(--transition),color var(--transition)}
    .ss{position:fixed;inset:0;display:block}
    canvas{position:absolute;inset:0;width:100%;height:100%;display:block}
    .logo-mark{position:absolute;left:50%;bottom:8vh;transform:translateX(-50%);width:clamp(64px,8vw,96px);opacity:1;filter:saturate(.9);pointer-events:none}
    .logo-mark img{width:100%;height:auto;opacity:1}
    .idle{cursor:none}
    @media (prefers-reduced-motion:reduce){body{transition:none}}
  </style>
</head>
<body>
  <main class="ss" aria-label="Beruhigender, dynamischer Screensaver">
    <canvas id="c"></canvas>
    <div class="logo-mark" aria-hidden="true">
      <img src="https://cdn.riverty.design/logo/riverty-logomark-light.svg" alt="">
    </div>
  </main>
  <script>
    (function(){
      var root=document.documentElement, lat=48.2082, lon=16.3738, ZEN=90.833, TW=45, TEMP=0;
      function dayOfYear(d){var s=new Date(d.getFullYear(),0,0);return Math.floor((d-s+(s.getTimezoneOffset()-d.getTimezoneOffset())*6e4)/864e5)}
      function norm(x,m){return (x%m+m)%m}
      function sTimes(d){var N=dayOfYear(d), lh=lon/15, rad=Math.PI/180, tz=-d.getTimezoneOffset()/60;
        function one(isRise){var t=N+((isRise?6:18)-lh)/24,M=0.9856*t-3.289,L=M+1.916*Math.sin(M*rad)+0.02*Math.sin(2*M*rad)+282.634;L=norm(L,360);var RA=Math.atan(0.91764*Math.tan(L*rad))/rad;RA=norm(RA,360);RA+=Math.floor(L/90)*90-Math.floor(RA/90)*90;RA/=15;var sD=0.39782*Math.sin(L*rad),cD=Math.cos(Math.asin(sD));var cH=(Math.cos(ZEN*rad)-sD*Math.sin(lat*rad))/(cD*Math.cos(lat*rad));var H=(isRise?360-Math.acos(cH)/rad:Math.acos(cH)/rad)/15;var T=H+RA-0.06571*t-6.622;var UT=T-lh;return norm(UT+tz,24)}
        return {sr:one(true)*60, ss:one(false)*60}
      }
      function smooth(a,b,x){var t=(x-a)/(b-a); if(t<=0) return 0; if(t>=1) return 1; return t*t*(3-2*t)}
      var canvas=document.getElementById('c'), ctx=canvas.getContext('2d');
      var DPR=Math.min(window.devicePixelRatio||1,1.5), w=0,h=0, now=0, last=performance.now();
      function rs(){w=canvas.width=Math.floor(innerWidth*DPR);h=canvas.height=Math.floor(innerHeight*DPR)} rs(); addEventListener('resize',rs);
      function mix(a,b,t){return a+(b-a)*t}
      function HSL(hh,ss,ll,a){return 'hsla('+hh+','+ss+'%,'+ll+'%,'+a+')'}
      var reduce=matchMedia&&matchMedia('(prefers-reduced-motion: reduce)').matches;
      var waves=[], motes=[], stars=[];
      function init(){
        waves=[
          {amp:.042,len:1.2,spd:.018,hueD:0,a:.20,blur:.7},
          {amp:.028,len:2.1,spd:.012,hueD:-6,a:.18,blur:.4},
          {amp:.018,len:3.2,spd:.009,hueD:-12,a:.14,blur:0}
        ];
        var mN=reduce?24:42; motes=[]; for(var i=0;i<mN;i++){motes.push({x:Math.random()*w,y:Math.random()*h*0.8+0.1*h,r:(Math.random()*2+1)*DPR,p:Math.random()*Math.PI*2,s:(Math.random()*0.18+0.06)*(reduce?.5:1)})}
        var sN=reduce?80:150; stars=[]; for(var j=0;j<sN;j++){stars.push({x:Math.random()*w,y:Math.random()*h*0.55,p:Math.random()*Math.PI*2,r:(Math.random()*1.2+.2)*DPR})}
      }
      init();
      var blend=0, sr=0, ss=0;
      function updateBlend(){
        var d=new Date(), t=sTimes(d); sr=t.sr; ss=t.ss; var m=d.getHours()*60+d.getMinutes();
        if(m<sr-TW||m>ss+TW) blend=1; else if(m>sr+TW&&m<ss-TW) blend=0; else if(m>=sr-TW&&m<=sr+TW) blend=1-smooth(sr-TW,sr+TW,m); else if(m>=ss-TW&&m<=ss+TW) blend=smooth(ss-TW,ss+TW,m);
        var theme=blend>=.5?'night':'day'; if(root.getAttribute('data-theme')!==theme) root.setAttribute('data-theme',theme);
      }
      updateBlend();
      setInterval(updateBlend,5*60*1000);
      document.addEventListener('visibilitychange',function(){if(!document.hidden) updateBlend()});
      function drawWaves(t){
        var k=blend;
        var hueDay=195+(-10*TEMP), hueNight=210+(-6*TEMP);
        var baseHue=mix(hueDay,hueNight,k);
        var baseY=h*mix(.62,.58,k);
        for(var i=0;i<waves.length;i++){
          var W=waves[i]; var amp=W.amp*h*mix(1,1.06,k); var len=W.len*220; var phase=t*W.spd*(reduce?.5:1)+i*0.5; var hue=baseHue+W.hueD;
          if(W.blur) ctx.filter='blur('+W.blur+'px)'; else ctx.filter='none';
          ctx.beginPath(); ctx.moveTo(0,h);
          for(var x=0;x<=w;x+=2*DPR){ var y=baseY+Math.sin((x/len)+phase)*amp+Math.cos((x/(len*2))-phase*.7)*amp*.45; ctx.lineTo(x,y); }
          ctx.lineTo(w,h); ctx.closePath(); ctx.fillStyle=HSL(hue, 44, mix(50,41,k), W.a); ctx.fill();
        }
        ctx.filter='none';
      }
      function drawMotes(dt){
        var k=blend; ctx.globalCompositeOperation='lighter'; ctx.fillStyle=k? 'rgba(255,255,255,'+mix(.02,.09,k)+')':'rgba(15,42,55,.06)';
        for(var i=0;i<motes.length;i++){var m=motes[i]; m.p+=(m.s*0.5)*(reduce?.5:1); m.x+=Math.cos(m.p)*m.s*10; m.y+=Math.sin(m.p*0.7)*m.s*8; if(m.x<-20||m.x>w+20||m.y<-20||m.y>h*0.92){m.x=Math.random()*w; m.y=h*0.15+Math.random()*h*0.7; m.p=Math.random()*Math.PI*2} ctx.beginPath(); ctx.arc(m.x,m.y,m.r,0,6.283); ctx.fill(); }
        ctx.globalCompositeOperation='source-over';
      }
      function drawStars(t){
        var k=Math.min(1,Math.max(0,blend)); if(k<.02) return; var aBase=.15+.65*k;
        for(var i=0;i<stars.length;i++){var s=stars[i]; var tw=.5+.5*Math.sin(t*.22+s.p*3.1); ctx.fillStyle='rgba(255,255,255,'+(aBase*tw)+')'; ctx.fillRect(s.x,s.y,s.r,s.r); }
      }
      var idleTimer=null, idle=false; function setIdle(v){if(idle===v)return; idle=v; document.body.classList.toggle('idle',idle)} function resetIdle(){setIdle(false); clearTimeout(idleTimer); idleTimer=setTimeout(function(){setIdle(true)},1500)} ['mousemove','touchstart','keydown'].forEach(function(ev){document.addEventListener(ev,resetIdle,{passive:true})}); resetIdle();
      function frame(t){ if(document.hidden){last=t; requestAnimationFrame(frame); return} var dt=(t-last)/1000; last=t; now+=dt; ctx.clearRect(0,0,w,h); drawStars(now); drawWaves(now); drawMotes(dt); requestAnimationFrame(frame) }
      requestAnimationFrame(frame);
    })();
  </script>
</body>
</html>
